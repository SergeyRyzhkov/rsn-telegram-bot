import { CustomBotContext } from "@/CustomBotContext";

const regexp =
  /(?<![Ğ°-ÑÑ‘])(?:(?:(?:Ñƒ|[Ğ½Ğ·]Ğ°|(?:Ñ…Ğ¸Ñ‚Ñ€Ğ¾|Ğ½Ğµ)?Ğ²Ğ·?[Ñ‹ÑŒÑŠ]|Ñ[ÑŒÑŠ]|(?:Ğ¸|Ñ€Ğ°)[Ğ·Ñ]ÑŠ?|(?:Ğ¾[Ñ‚Ğ±]|Ğ¿[Ğ¾Ğ°]Ğ´)[ÑŒÑŠ]?|(?:S(?=[Ğ°-ÑÑ‘]))+?[Ğ¾Ğ°ĞµĞ¸-])-?)?(?:[ĞµÑ‘](?:Ğ±(?!Ğ¾[Ñ€Ğ¹]|Ñ€Ğ°Ñ‡)|Ğ¿[ÑƒĞ°](?:Ñ†|Ñ‚Ñ))|Ğ¸[Ğ¿Ğ±][Ğ°Ğµ][Ñ‚Ñ†Ğ´][ÑŒÑŠ]).*?|(?:(?:Ğ½[Ğ¸ĞµĞ°]|Ñ€Ğ°[Ğ·Ñ]|[Ğ·Ğ´]?[Ğ°Ğ¾](?:Ñ‚|Ğ´Ğ½[Ğ¾Ğ°])?|Ñ(?:Ğ¼[ĞµĞ¸])?|Ğ°[Ğ¿Ğ±]Ñ‡)-?)?Ñ…Ñƒ(?:[ÑĞ¹Ğ¸ĞµÑ‘Ñ]|Ğ»+Ğ¸(?!Ğ³Ğ°Ğ½)).*?|Ğ±Ğ»(?:[ÑÑ]|ĞµĞ°?)(?:[Ğ´Ñ‚][ÑŒÑŠ]?)?|S*?(?:Ğ¿(?:[Ğ¸ĞµÑ‘]Ğ·Ğ´|Ğ¸Ğ´[Ğ°Ğ¾Ğµ]?Ñ€|ĞµĞ´(?:Ñ€(?!Ğ¾)|[Ğ°Ğ¾Ğµ]Ñ€|Ğ¸Ğº)|Ğ¾Ñ…ÑƒÑ)|Ğ±Ğ»Ñ(?:[Ğ´Ğ±Ñ†]|Ñ‚Ñ)|[Ğ¾Ğµ]Ñ…Ñƒ[ÑĞ¹Ğ¸ĞµÑ‘]|Ñ…ÑƒĞ¹Ğ½).*?|(?:Ğ¾[Ñ‚Ğ±]?|Ğ¿Ñ€Ğ¾|Ğ½Ğ°|Ğ²Ñ‹)?Ğ¼(?:Ğ°Ğ½Ğ´(?:[Ğ°ÑƒĞµÑ‹Ğ¸](?:Ğ»(?:Ğ¸[ÑĞ·Ñ‰])?[Ğ°ÑƒĞµĞ¸Ñ‹])?|Ğ¾Ğ¹|[Ğ°Ğ¾]Ğ².*?|ÑĞº(?:Ğ¾Ğ²|[Ğ°ÑƒĞ¸])?|Ğµ[Ğ½Ñ‚]ÑŒ|Ğ¸Ñ‰Ğ°)|ÑƒĞ´(?:[ÑĞ°Ğ¸Ğ¾Ğµ].+?|Ğµ?Ğ½(?:[ÑŒÑĞ¸Ñ]|ĞµĞ¹))|[Ğ°Ğ¾]Ğ»[Ğ°Ğ¾]Ñ„[ÑŒÑŠ](?:[ÑĞ¸ÑĞµ]|[ĞµÑ‘Ğ¾]Ğ¹))|ĞµĞ»Ğ´[Ğ°ÑƒÑ‹Ğµ].*?|Ğ»Ñ[Ñ‚Ğ´]ÑŒ|(?:[Ğ½Ğ·]Ğ°|Ğ¿Ğ¾)Ñ…)(?![Ğ°-ÑÑ‘])/;
const isMatch = (text: string) => {
  try {
    return regexp.test(text.toLowerCase());
  } catch (err) {
    console.log(err);
    return false;
  }
};

export const stopSwearWordsCommand = () => {
  return async (ctx: CustomBotContext) => {
    const text = ctx.msg?.text;
    if (!!text && !!ctx.msg && isMatch(text)) {
      console.log("====ĞœĞĞ¢ " + ctx.msg.from?.username);
      console.log(ctx.msg.text);
      console.log("====ĞœĞĞ¢=====");
      const sendText = `<tg-spoiler>${text}</tg-spoiler>\n@${ctx.msg.from?.username}\n<b>ĞĞµ Ñ€ÑƒĞ³Ğ°ĞµĞ¼ÑÑ Ğ¼Ğ°Ñ‚Ğ¾Ğ¼ ğŸ‘ğŸ‘ğŸ‘</b>`;
      await ctx.reply(sendText, {
        parse_mode: "HTML",
        reply_parameters: { message_id: ctx.msg.message_id },
      });
      ctx.msg.delete();
    }
  };
};
